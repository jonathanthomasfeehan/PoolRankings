
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pool Rankings Profile</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename= 'css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename= 'css/pages/profile.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


</head>
<body>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->

    
    <div>
        <h1>
            Hello {{name}}
        </h1>
    </div>
    <div class="container_fluid">
        <table class="table">
            <thead>
                <tr>
                    <th>You</th>
                    <th>Opponent</th>
                    <th>Result</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="matches_list">

            </tbody>
        </table>

        <!-- TODO: Update button -->
        <div>
            <form action = '/'>
                <button type = 'submit' name = 'home' class="index_nav_buttons">Home</button>
            </form>
        </div>
        <div></div>
            <form action = "{{ url_for('auth.passwordReset') }}">
                <button type = 'submit' name = 'passwordReset' class="index_nav_buttons">Update Password</button>
            </form>
        </div>
        <div> </div>
        <!-- <div>
        <a href="{{ url_for('auth.changePassword') }}" class="index_nav_buttons" id="profile">Update Password</a>

        </div> -->

    </div>
</body>

<script>
    window.onload = getMatchData;

    function getMatchData(){

        // let username = document.getElementById('Username').value
        // let password = document.getElementById('Password').value
        // let csrf = document.getElementById("csrf").value
        // let next = window.location.search.split('next=')[1]

        // sends post request, if successful then alerts client
        // 

        $.ajax({
            url:'/getUserMatchHistory',
            type:'POST',
            data: {"csrf_token":"{{csrf_token()}}"},
            success:function(response){
                // document.getElementById("matches_list").value = response.games;
                console.log(response)

                for(var i = 0; i<response.matches.length; i++){
                    let Player1 = response.matches[i].Player1
                    let Player2 = response.matches[i].Player2
                    console.log(response.requester)
                    let requester = response.requester
                    let otherplayer = Player1 == requester ? Player2: Player1
                    let newscore = 0
                    let oldscore = 0
                    let requester_win = false
                    if(requester == Player1){
                        newscore = response.matches[i].Player1_new_score 
                        oldscore = response.matches[i].Player1_previous_score
                    }else {
                        newscore = response.matches[i].Player2_new_score 
                        oldscore = response.matches[i].Player2_previous_score
                    }
                    if(newscore > oldscore) {
                        requester_win = true
                    }else {
                        requester_win = false
                    }
                    document.getElementById("matches_list").innerHTML += `<li>You played ${otherplayer}.` + (requester_win ? `You won!` : `You lost`) + `You're new score is ${newscore}`
                }


            },
            error:function(jqXHR, exception){
                console.log(jqXHR)
                if(jqXHR.status==450) {
                    alert("The database could not handle this request at this time. Please try again later")
                }
               

                else{
                    alert("Unexpected server error")


                }
            }

        })
    }



</script>